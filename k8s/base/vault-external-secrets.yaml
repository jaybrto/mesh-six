---
# ExternalSecret: syncs Vault secrets â†’ K8s Secret "mesh-six-claude-secrets"
# Requires ClusterSecretStore "vault-backend" to already exist in the cluster
# (deployed by github-workflow-agents or cluster-wide infra)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mesh-six-claude-secrets
  namespace: mesh-six
  labels:
    app.kubernetes.io/part-of: mesh-six
    component: secrets
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: claude-secret
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    # Claude OAuth token (subscription auth)
    - secretKey: oauth-token
      remoteRef:
        key: secret/data/mesh-six
        property: claude-oauth-token
    # Claude OAuth account metadata (prevents first-run dialogs)
    - secretKey: oauth-account-uuid
      remoteRef:
        key: secret/data/mesh-six
        property: oauth-account-uuid
    - secretKey: oauth-email
      remoteRef:
        key: secret/data/mesh-six
        property: oauth-email
    - secretKey: oauth-org-uuid
      remoteRef:
        key: secret/data/mesh-six
        property: oauth-org-uuid
---
# ExternalSecret: syncs existing infra secrets from Vault
# Replaces manually-created secrets in secrets.yaml
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mesh-six-infra-secrets
  namespace: mesh-six
  labels:
    app.kubernetes.io/part-of: mesh-six
    component: secrets
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: litellm-secret
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    - secretKey: api-key
      remoteRef:
        key: secret/data/mesh-six
        property: litellm-api-key
